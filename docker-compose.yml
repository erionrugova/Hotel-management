# Production docker-compose - uses existing MySQL container
# MySQL container (hotel-mysql) should be started separately: docker start hotel-mysql

services:
  # Backend API Server
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: hotel-server
    restart: unless-stopped
    environment:
      # Connect to existing MySQL container by IP (on bridge network)
      # Make sure hotel-mysql is running: docker start hotel-mysql
      # MySQL IP: Get current IP with: docker inspect hotel-mysql --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
      # Note: IP may change when container restarts. Consider using a custom Docker network instead.
      DATABASE_URL: mysql://hotel_user:hotel_password@172.17.0.2:3306/hotel_management
      JWT_SECRET: your-super-secret-jwt-key-change-in-production
      JWT_EXPIRES_IN: 24h
      PORT: 3000
      NODE_ENV: development
      ENABLE_RATE_LIMIT: "false"
    env_file:
      - ./server/.env
    ports:
      - "3000:3000"
    network_mode: bridge
    volumes:
      - ./server/uploads:/app/uploads
    command: >
      sh -c "
        echo 'Connecting to existing MySQL database (hotel-mysql) at 172.17.0.3:3306...' &&
        sleep 3 &&
        npx prisma generate &&
        node src/server.js
      "
