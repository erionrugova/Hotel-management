generator client {
  provider = "prisma-client-js"
  output = "./node_modules.nosync/@prisma/client"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  role      Role      @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]

  @@map("users")
}

model Guest {
  id        Int      @id @default(autoincrement())
  fullName  String
  email     String?
  bookingId Int
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  roomId    Int?
  room      Room?    @relation(fields: [roomId], references: [id])
  status    String   @default("Reserved")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Room {
  id          Int              @id @default(autoincrement())
  roomNumber  String           @unique
  type        rooms_type
  price       Decimal          @db.Decimal(10, 2)
  status      RoomStatus       @default(AVAILABLE)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  description String?          @db.Text
  bookings    Booking[]
  rates       rates[]
  features    RoomFeatureMap[]

  // ðŸ‘‡ Opposite relation
  guests Guest[]

  @@map("rooms")
}

model Booking {
  id                Int                   @id @default(autoincrement())
  userId            Int
  roomId            Int
  startDate         DateTime
  endDate           DateTime
  status            BookingStatus         @default(PENDING)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  customerFirstName String?               @db.VarChar(100)
  customerLastName  String?               @db.VarChar(100)
  customerEmail     String?
  paymentType       bookings_paymentType?
  room              Room                  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user              User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  // ðŸ‘‡ Opposite relation
  guests Guest[]

  @@index([roomId], map: "bookings_roomId_fkey")
  @@index([userId], map: "bookings_userId_fkey")
  @@map("bookings")
}

model RoomFeature {
  id        Int               @id @default(autoincrement())
  name      String            @db.VarChar(100)
  rooms     RoomFeatureMap[]
  roomTypes RoomTypeFeature[]

  @@map("room_features")
}

model RoomFeatureMap {
  id        Int         @id @default(autoincrement())
  roomId    Int
  featureId Int
  room      Room        @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "room_feature_map_ibfk_1")
  feature   RoomFeature @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "room_feature_map_ibfk_2")

  @@index([featureId], map: "featureId")
  @@index([roomId], map: "roomId")
  @@map("room_feature_map")
}

model RoomTypeFeature {
  id        Int         @id @default(autoincrement())
  roomType  String      @db.VarChar(50)
  featureId Int
  feature   RoomFeature @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "room_type_features_ibfk_1")

  @@index([featureId], map: "featureId")
  @@map("room_type_features")
}

model deals {
  id        Int            @id @default(autoincrement())
  name      String
  discount  Int
  status    deals_status?  @default(ONGOING)
  endDate   DateTime?      @db.Date
  roomType  deals_roomType
  createdAt DateTime?      @default(now()) @db.Timestamp(0)
  updatedAt DateTime?      @default(now()) @db.Timestamp(0)
}

model rates {
  id           Int          @id @default(autoincrement())
  roomId       Int
  policy       rates_policy
  rate         Decimal      @db.Decimal(10, 2)
  dealPrice    Decimal?     @db.Decimal(10, 2)
  availability Int
  createdAt    DateTime?    @default(now()) @db.Timestamp(0)
  updatedAt    DateTime?    @default(now()) @db.Timestamp(0)
  rooms        Room         @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "rates_ibfk_1")

  @@index([roomId], map: "roomId")
}

enum Role {
  ADMIN
  MANAGER
  USER
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  OUT_OF_ORDER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum rooms_type {
  SINGLE
  DOUBLE
  SUITE
  DELUXE
}

enum bookings_paymentType {
  CARD
  CASH
  PAYPAL
}

enum rates_policy {
  STRICT
  FLEXIBLE
  NON_REFUNDABLE
}

enum deals_status {
  ONGOING
  FULL
  INACTIVE
}

enum deals_roomType {
  SINGLE
  DOUBLE
  SUITE
  DELUXE
}
