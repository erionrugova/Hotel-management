generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  role      Role      @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]

  @@map("users")
}

model Room {
  id          Int              @id @default(autoincrement())
  roomNumber  String           @unique
  type        rooms_type
  price       Decimal          @db.Decimal(10, 2)
  status      RoomStatus       @default(AVAILABLE)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  description String?          @db.Text
  bookings    Booking[]
  features    RoomFeatureMap[]

  @@map("rooms")
}

model Booking {
  id                Int                   @id @default(autoincrement())
  userId            Int
  roomId            Int
  startDate         DateTime
  endDate           DateTime
  status            BookingStatus         @default(PENDING)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  customerFirstName String?               @db.VarChar(100)
  customerLastName  String?               @db.VarChar(100)
  customerEmail     String?
  paymentType       bookings_paymentType?
  room              Room                  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user              User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([roomId], map: "bookings_roomId_fkey")
  @@index([userId], map: "bookings_userId_fkey")
  @@map("bookings")
}

model RoomFeature {
  id        Int               @id @default(autoincrement())
  name      String            @db.VarChar(100)
  rooms     RoomFeatureMap[]
  roomTypes RoomTypeFeature[]

  @@map("room_features")
}

model RoomFeatureMap {
  id        Int         @id @default(autoincrement())
  roomId    Int
  featureId Int
  room      Room        @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "room_feature_map_ibfk_1")
  feature   RoomFeature @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "room_feature_map_ibfk_2")

  @@index([featureId], map: "featureId")
  @@index([roomId], map: "roomId")
  @@map("room_feature_map")
}

model RoomTypeFeature {
  id        Int         @id @default(autoincrement())
  roomType  String      @db.VarChar(50)
  featureId Int
  feature   RoomFeature @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "room_type_features_ibfk_1")

  @@index([featureId], map: "featureId")
  @@map("room_type_features")
}

enum Role {
  ADMIN
  MANAGER
  USER
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  OUT_OF_ORDER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum rooms_type {
  SINGLE
  DOUBLE
  SUITE
  DELUXE
}

enum bookings_paymentType {
  CARD
  CASH
  PAYPAL
}
